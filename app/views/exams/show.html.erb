<div class="max-w-4xl mx-auto py-8">
  <h1 class="text-3xl font-bold text-gray-900 mb-6">è©¦é¨“çµæœ</h1>

  <div
  data-controller="<%= @needs_reveal_animation ? "result-reveal" : nil %>"
  data-result-reveal-score-value="<%= @exam.score_percentage %>"
  data-result-reveal-passed-value="<%= @exam.passed? %>">

  <%
    reveal_class = @needs_reveal_animation ? "opacity-0" : ""
    bar_width = "width: #{@exam.score_percentage > 100 ? 100 : @exam.score_percentage}%;"
    summary_bg_class = @exam.passed? ? "bg-green-50 border-green-500" : "bg-red-50 border-red-500"
    summary_text_class = @exam.passed? ? "text-green-700" : "text-red-700"
    initial_summary_class = @needs_reveal_animation ? "bg-gray-50 border-gray-500" : summary_bg_class
    initial_bar_color = @needs_reveal_animation ? "bg-gray-400" : (@exam.passed? ? "bg-indigo-500" : "bg-red-500")
    transition_class = @needs_reveal_animation ? "transition-all duration-3000 ease-out" : ""
  %>

    <div data-result-reveal-target="summary"
         class="p-6 rounded-xl shadow-xl mb-8 transition-colors duration-500 border-2 <%= initial_summary_class %>">

      <h2 data-result-reveal-target="message"
          class="text-2xl font-bold mb-2 transition-opacity duration-500 <%= reveal_class %> <%= @needs_reveal_animation ? "" : summary_text_class %>">
        <%= @exam.passed? ? "ğŸ‰ åˆæ ¼ã§ã™ï¼" : "ğŸ˜¢ ä¸åˆæ ¼" %>
      </h2>

      <div class="my-4">
        <h3 class="text-sm font-medium text-gray-600 mb-1">é”æˆåº¦</h3>
        <%= render "progress_bar", exam: @exam, animate: @needs_reveal_animation %>
      </div>

      <p class="text-lg text-gray-800 transition-opacity duration-500 <%= reveal_class %>" data-result-reveal-target="scoreDetail">
        æ­£ç­”ç‡: <span class="font-extrabold text-xl"><%= @exam.score_percentage %>%</span> (åˆæ ¼åŸºæº–: <%= Exam::PASSING_SCORE_PERCENTAGE %>%)
      </p>
      <p class="text-lg text-gray-800 transition-opacity duration-500 <%= reveal_class %>" data-result-reveal-target="scoreDetail">
        æ­£è§£æ•°: <span class="font-extrabold text-xl"><%= @exam.correct_count %>å•</span> / <%= @exam.total_questions %>å•ä¸­
      </p>
    </div>

    <h2 data-result-reveal-target="detailHeader" class="text-2xl font-bold text-gray-900 mb-4 transition-opacity duration-500 <%= reveal_class %>">
      å•é¡Œã”ã¨ã®è©³ç´°
    </h2>

    <div data-result-reveal-target="detailTable" class="bg-white shadow-lg rounded-xl overflow-hidden transition-opacity duration-500 <%= reveal_class %>">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/12">No.</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-5/12">å•é¡Œæ¦‚è¦</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/12">ã‚«ãƒ†ã‚´ãƒªãƒ¼</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/12">åˆ¤å®š</th>
            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-2/12">è©³ç´°</th>
          </tr>
        </thead>

        <tbody class="bg-white divide-y divide-gray-200">
          <% @exam_questions.each do |eq| %>
            <tr class="<%= eq.correct? ? "hover:bg-green-50" : "hover:bg-red-50" %> cursor-pointer"
                data-question-content="<%= eq.question.content.truncate(50) %>"
                data-question-id="<%= eq.question.id %>">

              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                <%= eq.position %>
              </td>
              <td class="px-6 py-4 text-sm text-gray-700">
                <%= eq.question.content.truncate(70) %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                <%= eq.question.category&.name %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold">
                <%= eq.correct? ?
                    '<span class="text-green-600">æ­£è§£</span>'.html_safe :
                    '<span class="text-red-600">ä¸æ­£è§£</span>'.html_safe %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                <%= link_to "è©³ç´°ã‚’è¦‹ã‚‹", solution_exam_exam_question_path(@exam, eq),
                      data: { turbo_stream: true },
                      class: "text-indigo-600 hover:text-indigo-900 font-medium" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div data-result-reveal-target="actionButtons"
         class="mt-8 flex justify-center space-x-4 transition-opacity duration-500 <%= reveal_class %>">

      <%= link_to "ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹", root_path,
          class: "bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-150" %>

      <%= link_to "å±¥æ­´ä¸€è¦§ã¸æˆ»ã‚‹", exams_path,
          class: "bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-150" %>
    </div>
  </div>
</div>
