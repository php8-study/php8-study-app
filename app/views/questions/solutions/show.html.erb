<% plain_content = strip_tags(MarkdownRenderer.render(@question.content)).squish %>
<% title "[解説] #{@question.category.name}: #{plain_content.truncate(30)}" %>
<% explanation_text = @question.explanation.presence || "正解の確認と、詳細な解説を確認しましょう。" %>
<% summary = "PHP8試験対策：#{plain_content.truncate(80)} ... #{explanation_text.tr("\n", " ").truncate(50)}" %>
<% set_meta_tags description: summary %>

<main class="bg-slate-50 py-12 relative">

  <div class="max-w-3xl mx-auto space-y-8 px-4 sm:px-6">

    <% if current_user %>
      <%= render Questions::ResultStatus::Component.new(is_correct: @is_correct) %>
    <% end %>

    <%= render Common::TerminalDisplay::Component.new(
        body: @question.content,
        label: "Question.php (Review)"
      ) %>

    <%= render Questions::ChoicesFeedback::Component.new(
      question: @question,
      user_choice_ids: @user_answer_ids
    ) %>

    <%= render Questions::ReferenceInfo::Component.new(question: @question) %>

    <% unless current_user %>
      <div class="mt-8 pt-8 border-t border-slate-200">
        <%= render Common::Button::Component.new(
              href: root_path,
              variant: :primary,
              size: :lg,
              class: "w-full py-3"
            ) do %>
          <%= inline_svg_tag "icons/logout.svg", class: "w-5 h-5 mr-2", aria_hidden: true %>
          ログインして学習をはじめる
        <% end %>
      </div>
    <% end %>

  </div>

  <% if current_user %>
    <%= render Questions::StickyNav::Component.new(next_path: questions_random_path) %>
  <% end %>

</main>
