<% result_class = @is_correct ? "bg-green-50 border-green-500 text-green-800" : "bg-red-50 border-red-500 text-red-800" %>
<% result_icon = @is_correct ? "✅ 正解！" : "❌ 不正解" %>

<div class="max-w-xl mx-auto py-8">
  <h1 class="text-3xl font-bold text-gray-900 mb-6">解答と参照情報</h1>

  <div class="p-6 border-l-4 <%= result_class %> rounded-r-lg shadow-sm mb-8">
    <div class="text-2xl font-extrabold flex items-center gap-2">
      <%= result_icon %>
    </div>
    <% unless @is_correct %>
      <p class="mt-2 text-lg opacity-90">もう一度確認してみましょう。</p>
    <% end %>
  </div>

  <div class="bg-white p-6 shadow-lg rounded-xl mb-8">
    <h2 class="text-xl font-semibold text-indigo-700 mb-4">問題 <%= @question.id %></h2>
    <p class="text-lg text-gray-800 whitespace-pre-wrap mb-6"><%= @question.content %></p>

    <h3 class="text-lg font-bold text-gray-900 mb-3 border-b pb-1">選択肢の正誤</h3>
    <div class="space-y-3">
      <% @question.question_choices.each do |choice| %>
        <%
          is_user_selected = @user_answer_ids.include?(choice.id)
          is_correct_choice = choice.correct?
      
          choice_class = ""
          if is_user_selected && is_correct_choice
            choice_class = "bg-white border-2 border-green-500 shadow-sm"
          elsif is_user_selected && !is_correct_choice
            choice_class = "bg-white border-2 border-red-500 shadow-sm"
          elsif !is_user_selected && is_correct_choice
            choice_class = "bg-white border-2 border-yellow-400 border-dashed"
          else
            choice_class = "bg-gray-50 border border-gray-200"
          end
        %>
        
        <div class="p-3 rounded-lg <%= choice_class %> flex justify-between items-center transition-colors">
          <span class="text-md text-gray-700 font-medium">
            <%= choice.content %>
          </span>

          <div class="text-sm font-semibold whitespace-nowrap">
            <% if is_correct_choice %>
              <span class="text-green-600 flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
                正解
              </span>
            <% end %>
            <% if is_user_selected %>
              <span class="ml-2 text-indigo-600 text-xs bg-indigo-50 px-2 py-1 rounded-full">
                あなたの回答
              </span>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <div class="bg-white p-6 shadow-lg rounded-xl mb-8">
    <h3 class="text-lg font-bold text-gray-900 mb-3 border-b pb-1">参照情報</h3>
      
    <% if @question.official_page.present? %>
      <p class="text-gray-700">公式テキストの参照箇所は以下の通りです。</p>
      <p class="mt-2 text-xl font-semibold text-indigo-700">
        ページ: <%= @question.official_page %>
      </p>
    <% else %>
      <p class="text-gray-500">この問題には参照情報が設定されていません。</p>
    <% end %>
  </div>

  <div class="flex justify-between gap-4">
    <%= link_to "トップへ戻る", root_path, 
        class: "flex-1 text-center text-gray-700 bg-gray-200 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors" %>
    
    <%= link_to "次の問題へ", random_questions_path, 
        class: "flex-1 text-center bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors" %>
  </div>
</div>
